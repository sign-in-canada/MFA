<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:b="http://bootsfaces.net/ui"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    template="/WEB-INF/incl/layout/login-template.xhtml">
    <f:metadata>
        <f:viewAction action="#{authenticator.prepareAuthenticationForStep}" />
        <f:viewParam name="login_hint" value="#{loginAction.loginHint}" />
    </f:metadata>
    <ui:define name="head">
        <meta name="description" content="MFA Login" />
    </ui:define>
    <ui:define name="pageTitle">
        <h:outputText value="#{msgs['login.pageTitle']}" />
    </ui:define>
    <ui:define name="body">
        <div class="container">
            <h:panelGroup rendered="true">
                <div class="login_bx_1" style="border-radius: 10px; margin-top: 0px; background: white; border: 1px solid #008b8b;">
                    <div class="row">
                        <h:messages class="text-center"
                            style="color:#8b0000;margin:5px;margin-left:20px; font-size:2vw;"
                            infoClass="text-center" errorClass="text-center" />
                    </div>
                    <b:form horizontal="true" id="loginForm" style="padding:30px;">
                        <h:inputHidden id="mfachoice" styleClass="form-control" autocomplete="off" />
                                                <h:inputHidden id="platform" />
                        <div class="row">
                            <div>
                                <h2>This is your new recovery code: 
                                  <h:outputText escape="false" value="#{ identity.getWorkingParameter('new_code')}" />
                                </h2>
                                <p>Please confirm you wrote it down as a physical storage.</p>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-sm-offset-1 offset-md-1 col-sm-8 col-md-8">
                                <h:selectBooleanCheckbox id="confirmCodeBox" styleClass="checkmark" style="position:relative !important;" type="checkbox"></h:selectBooleanCheckbox>
                                <label style="vertical-align:middle;">I confirm I wrote down the code and stored it safely.</label>
                            </div>
                            <br/><br/>
                            <div class="col-sm-offset-1 offset-md-1 col-sm-8 col-md-8">
                                <h:commandButton id="loginButton2" value="Confirm code receipt" type="submit"
                                    style="background-color: #00BE79; color:white;" styleClass="btn col-sm-12" iconAwesome="fa-sign-in"
                                    onclick="fillInAcrOnSubmit('u2f')" action="#{authenticator.authenticate}">
                                </h:commandButton>
                            </div>
                        </div>
                    </b:form>
                </div>
            </h:panelGroup>
        </div>
    <script type="text/javascript">

      $(document).ready(function () {
        fillPlatformField();
      });

      function fillInAcrOnSubmit(acrButtonValue){
        document.getElementById("loginForm:mfachoice").value = acrButtonValue;
      }

      function fillPlatformField() {
        try {
          re = /^([^\.]+\.[^\.]+)\..+/;
          result = re.exec(platform.version);
          if (result != null) {
            platform.version=result[1];
          }
              document.getElementById("loginForm:platform").value = JSON.stringify(platform);
        } catch (e) {
        }
      }
    </script>
    </ui:define>
</ui:composition>

