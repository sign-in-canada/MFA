# MFA4ATIP Data Elements

MFA4ATIP creates, collects, processes and/or stores the following data elements:

## Discrete Data Elements

### Authorization Code

#### Description

An OAuth 2.0 Authorization Code Grant. See: https://oauth.net/2/grant-types/authorization-code/

#### Sensitivity

Protected B

#### Example

    7275ceac-23db-4e4f-b31e-7f3237d56f71

### Pairwise Pseudonym (PAI)

#### Description

An anonymous, locally unique and never reassigned identifier within MFA4ATIP for the End-User, which is intended to be consumed by the Sign In Canada Acceptance Platform.

#### Sensitivity

Protected B

#### Example

    mfa6cc02a2076d94df9a8d85c70496735c7

### Client Identifier (clientID)

#### Description

An OAuth 2.0 client identifier. See: https://tools.ietf.org/html/rfc6749#section-2.2

Issued by MFA 4 ATIP to the Sign In Canada Acceptance Platform.

#### Sensitivity

Unclassified

#### Example

    dhpp3640-fa7d-474d-bd9f-705c30b52dd0

### Client Secret

#### Description

An OAuth 2.0 client password. See: https://tools.ietf.org/html/rfc6749#section-2.3.1

Issued by MFA4ATIP to the Sign In Canada Acceptance Platform, and used by the Acceptance Platform to authenticate to the MFA4ATIP token endpoint.

#### Sensitivity

Protected B

#### Example

    Yrv6Dq7JwMN37SPTV49AO06M

### Session Language (Language)

#### Description

An ISO 639-1 code indicating the end-user's choice of official language. Used to present
the user with web pages in their preferred language.

#### Sensitivity

Unclassified

#### Example

    fr

### TOTP secret key

#### Description

A secret key, shared between MFA4ATIP and the end-user's mobile authenticator
app. See: https://tools.ietf.org/html/rfc6238

#### Sensitivity

Protected B

#### Example

## Composite Data Elements

### Login Hint

#### Description

An encrypted data structure that contains both the end-user's pairwise pseudonym, and the identity of the relying party they are authenticating to. The Sign In Canada Acceptance platform passes the login hint to MFA4ATIP in the OpenID Connect authentication request. MFA4ATIP uses the pairwise pseudonym in the login hint to either create a user account for new users, or to identify the account to which an existing user is expected to authenticate. The identity of the relying party is used to by MFA4ATIP to customize the content of the user interface for that relying party application.

#### Sensitivity

Protected B

#### Example

    QkZJdkdFTUdSQmtYV01PU1hwUVE5QmtDSzNUUU1RK29ESmUrVVFzS1BlaHRlWGZyb2l6OU9iNVR5eDRvOFJZZ2h0Q094MkpreE9KZWZtZzRPejVDS3Y3azAva25BTGtHcU5Td2VyelNaWFM5L2QyLzc1Sjlza3ZLQTRrPQ

### Authentication Request

#### Description

An OpenID Connect authentication request. See: https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest

Generated by the Sign In Canada Acceptance Platform and send to MFA 4 ATIP via the end-user's browser.

#### Sensitivity

Unclassified

#### Example

    https://qa-mfa.id.tbs-sct.gc.ca/oxauth/restv1/authorize?response_type=code&client_id=dhpp3640-fa7d-474d-bd9f-705c30b52dd0&redirect_uri=https%3A%2F%2Fdev3-auth.id.tbs-sct.gc.ca%2Fpassport%2Fauth%2Fmfa%2Fcallback&scope=openid&login_hint=QkZJdkdFTUdSQmtYV01PU1hwUVE5QmtDSzNUUU1RK29ESmUrVVFzS1BlaHRlWGZyb2l6OU9iNVR5eDRvOFJZZ2h0Q094MkpreE9KZWZtZzRPejVDS3Y3azAva25BTGtHcU5Td2VyelNaWFM5L2QyLzc1Sjlza3ZLQTRrPQ&ui_locales=en&state=cIvneTLRjiF1008ovpxvbT4k

### Token Request

#### Description

An HTTP request to the MFA4ATIP token endpoint. See: https://openid.net/specs/openid-connect-core-1_0.html#TokenRequest

#### Sensitivity

Protected B

#### Example

    POST /oxauth/restv1/token HTTP/1.1
    Host: qa-mfa.id.tbs-sct.gc.ca
    Content-Type: application/x-www-form-urlencoded

    grant_type=authorization_code&code=SplxlOBeZQQYbYS6WxSbIA&redirect_uri=redirect_uri=https%3A%2F%2Fdev3-auth.id.tbs-sct.gc.ca%2Fpassport%2Fauth%2Fmfa%2Fcallback&client_id=dhpp3640-fa7d-474d-bd9f-705c30b52dd0&client_secret=Yrv6Dq7JwMN37SPTV49AO06M

### ID Token

#### Description

A security token that contains claims about the authentication of an end-user, including their pairwise pseudonym (PAI). Issued by MFA4ATIP and consumed by the Sign In Canada Acceptance Platform.
See: https://openid.net/specs/openid-connect-core-1_0.html#IDToken

#### Sensitivity

Protected B

#### Example

    {
     "iss": "https://qa-mfa.id.tbs-sct.gc.ca",
     "sub": "mfa6cc02a2076d94df9a8d85c70496735c7",
     "aud": "dhpp3640-fa7d-474d-bd9f-705c30b52dd0",
     "nonce": "n-0S6_WzA2Mj",
     "exp": 1311281970,
     "iat": 1311280970,
     "auth_time": 1311280969
    }

### User Account

#### Description

All of the data associated with an end-users account is represented as a
 [JSON](https://www.json.org/json-en.html) document stored in the NoSQL
 database. The member data elements of these documents consist of anonymous
 identifiers, the user's recovery code, and cryptographic material and metadata
 associated with their registered second-factor authenticator.

Anonymous identifiers include a unique randomly-generated user_id, the pairwise pseudonym used by the Sign In Canada Acceptance platform, and a unique randomly-generated International Number (inum) used as a primary key for database operations.

The authenticator metadata and cryptographic material for a user account consists of either a [TOTP secret key](https://tools.ietf.org/html/rfc6238), or a [FIDO U2F](https://fidoalliance.org/specs/fido-u2f-v1.2-ps-20170411/fido-u2f-overview-v1.2-ps-20170411.html) device registration.

A FIDO U2F device (security key) registration consists of:

1. The device's attestation certificate and public key. See: https://fidoalliance.org/specs/fido-u2f-v1.2-ps-20170411/fido-u2f-overview-v1.2-ps-20170411.html#verifying-that-a-u2f-device-is-genuine
2. The most recently retrieved value of the device's usage counter. See: https://fidoalliance.org/specs/fido-u2f-v1.2-ps-20170411/fido-u2f-overview-v1.2-ps-20170411.html#counters-as-a-signal-for-detecting-cloned-u2f-devices
3. The Key Handle for the user's MFA4ATIP private key. See: https://fidoalliance.org/specs/fido-u2f-v1.2-ps-20170411/fido-u2f-overview-v1.2-ps-20170411.html#site-specific-public-private-key-pairs
4. A numeric hash of the Key Handle, used to optimize database/directory queries. See: https://github.com/GluuFederation/oxAuth/blob/210c9462b14146a97b34860e600945204098bbc1/Server/src/main/java/org/gluu/oxauth/service/fido/u2f/DeviceRegistrationService.java#L213-L225

Recovery codes and TOTP secrets stored in the database are encrypted.

#### Sensitivity

Protected B

#### Examples

A user account with TOTP authenticator:

    {
    "oxExternalUid": [
        "sic-mfa:mfa6cc02a2076d94df9a8d85c70496735c7",
        "totp:ESGCLt8siOZ5ckUHBJzSamv7H8lra4fSM7AGVuYoHo270iffrcGBpc6VNKI0SgTFC36exZ0Q8jg/2OoEi3BjcaO+DGP3TXYJw4Zy05rl0LN359c3YLl3YP5ewG35k/ym9/D2tc2e6BRIyT7x"
    ],
    "objectClass": "gluuPerson",
    "uid": "c6fa17fcc2f447d6925807e74c6a0e5e",
    "dn": "inum=139d29f1-2920-468a-8b1a-4eea6185ebae,ou=people,o=gluu",
    "inum": "139d29f1-2920-468a-8b1a-4eea6185ebae",
    "gluuStatus": "active",
    "oxPPID": "mfa6cc02a2076d94df9a8d85c70496735c7",
    "secretAnswer": "Q27huHsnHHMVk9i8VHXLz4/v7iKE8womhZGmTg=="
    }

A user account with a FIDO U2F authenticator:

    {
    "oxExternalUid": [
        "sic-mfa:mfa6cc02a2076d94df9a8d85c70496735c7",
        "totp:ESGCLt8siOZ5ckUHBJzSamv7H8lra4fSM7AGVuYoHo270iffrcGBpc6VNKI0SgTFC36exZ0Q8jg/2OoEi3BjcaO+DGP3TXYJw4Zy05rl0LN359c3YLl3YP5ewG35k/ym9/D2tc2e6BRIyT7x"
    ],
    "objectClass": "gluuPerson",
    "uid": "c6fa17fcc2f447d6925807e74c6a0e5e",
    "dn": "inum=139d29f1-2920-468a-8b1a-4eea6185ebae,ou=people,o=gluu",
    "inum": "139d29f1-2920-468a-8b1a-4eea6185ebae",
    "gluuStatus": "active",
    "oxPPID": "mfa6cc02a2076d94df9a8d85c70496735c7",
    "secretAnswer": "Q27huHsnHHMVk9i8VHXLz4/v7iKE8womhZGmTg=="
    }

